<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Cleaning Assignment – Manager View</title>
    <style>
        body { background:#141414; color:#fff; font-family:Arial; padding:20px; }
        h1, h2 { color:#e50914; }
        .container { max-width:1200px; margin:0 auto; }
        select, button { padding:10px; margin:10px 0; font-size:16px; width:100%; max-width:400px; }
        button { background:#e50914; color:white; border:none; border-radius:4px; cursor:pointer; }
        button:hover { background:#f40612; }
        table { width:100%; border-collapse:collapse; margin:20px 0; }
        th, td { padding:10px; border:1px solid #333; text-align:left; }
        th { background:#e50914; }
        .message { color:#0f0; font-weight:bold; margin:20px 0; }
        .back { margin:30px 0; }
        .filter-buttons button { width:auto; margin-right:10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cleaning Assignment – Manager View</h1>

        <p style="text-align:center; font-size:1.3em; margin:0;"> 
            Welcome, <strong>{{ manager_name }}</strong>!
        </p>

        {% if message %}
            <p class="message">{{ message }}</p>
        {% endif %}

        <h2>Rooms which need service after screenings</h2>
        <form method="POST">
            <label for="room">Select Room:</label>
            <select name="room" id="room" required>
                {% for room in rooms %}
                    <option value="{{ room.RoomID }}">Room {{ room.RoomID }} ({{ room.ScreeningType }}, Capacity: {{ room.Capacity }})</option>
                {% endfor %}
            </select><br>

            <label for="workers">Select Workers:</label>
            <select name="workers" id="workers" multiple size="8" required>
                {% for worker in workers %}
                    <option value="{{ worker.EmployeeID }}">{{ worker.Name }} ({{ worker.Position }})</option>
                {% endfor %}
            </select><br>

            <button type="submit">Assign Workers</button>
        </form>

        <h2>Filter Workers by their Position</h2>
        <div class="filter-buttons">
            <select id="position_filter" onchange="window.location.href='/cleaning-michelle?position=' + this.value + '&manager_id=' + '{{ manager_id }}'">
                <option value="">All Positions</option>
                <option value="Cleaner" {% if position_filter == 'Cleaner' %}selected{% endif %}>Cleaner</option>
                <option value="Technician" {% if position_filter == 'Technician' %}selected{% endif %}>Technician</option>
                <option value="Usher" {% if position_filter == 'Usher' %}selected{% endif %}>Usher</option>
            </select>
        </div>

        <h2>Current Worker Workload Report</h2>
        <table>
            <tr>
                <th>Worker Name</th>
                <th>Position</th>
                <th>Assigned Rooms (Count)</th>
                <th>Assigned Rooms (List)</th>
                <th>Working Hours</th>
                <th>Delete from Room</th>
            </tr>
            {% for row in workload %}
                <tr>
                    <td>{{ row.Name }}</td>
                    <td>{{ row.Position }}</td>
                    <td>{{ row.assigned_count }}</td>
                    <td>{{ row.assigned_rooms_list or 'None' }}</td>
                    <td>{{ row.WorkingHours }}</td>
                    <td>
                        {% if row.assigned_count > 0 %}
                            <form method="POST" style="margin:0;">
                                <input type="hidden" name="delete_worker" value="{{ row.EmployeeID }}">
                                <select name="delete_room" required>
                                    {% for r in row.assigned_rooms_list.split(',') %}
                                        <option value="{{ r }}">Room {{ r }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" name="delete" onclick="return confirm('Delete this assignment?')">Delete</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>

        <div class="back">
            <a href="/"><button>← Back to mainpage</button></a>
            <a href="/status"><button>Database-state</button></a>
        </div>
    </div>
</body>
</html>